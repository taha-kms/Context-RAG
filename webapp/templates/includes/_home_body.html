<section id="documents" aria-labelledby="documents-title">
  <h2 id="documents-title">Available Documents</h2>

  {% if docs and docs|length > 0 %}
    <ul class="list">
      {% for d in docs %}
        <li>
          <code>{{ d.path }}</code>
          <small class="muted">({{ (d.size // 1024) }} KB)</small>
        </li>
      {% endfor %}
    </ul>
    <p><small>{{ docs|length }} file{{ 's' if docs|length != 1 else '' }} found.</small></p>
  {% else %}
    <div class="alert">No supported documents found yet. Add files under your <code>DATA_DIR</code> and refresh.</div>
  {% endif %}
</section>

<hr />

<section id="ask" aria-labelledby="ask-title">
  <h2 id="ask-title">Ask a Question</h2>

  <form action="{{ url_for('main.ask') }}" method="post" class="ask-form">
    <label for="question" class="visually-hidden">Question</label>
    <textarea id="question" name="question" rows="3" style="width:100%;" placeholder="Type your question...">{{ question or "" }}</textarea>
    <div style="margin-top:8px;">
      <input type="submit" value="Ask">
    </div>
  </form>

  {% if answer %}
    <div class="answer" style="margin-top:16px;">
      <h3>Answer</h3>
      <div class="card">
        <p>{{ answer }}</p>
      </div>

      <h4 style="margin-top:12px;">Sources</h4>
      {% if sources and sources|length > 0 %}
        <ul class="list">
          {% for s in sources %}
            <li>
              <code>{{ s.source }}</code>
              {% if s.chunk is not none %}<small class="muted">#chunk{{ s.chunk }}</small>{% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No sources returned.</p>
      {% endif %}

      <details style="margin-top:8px;">
        <summary>Raw sources string</summary>
        <pre style="white-space:pre-wrap">{{ sources_raw }}</pre>
      </details>
    </div>
  {% endif %}
</section>
<hr />

<section id="upload" aria-labelledby="upload-title">
  <h2 id="upload-title">Upload &amp; Reindex</h2>

  <form action="{{ url_for('main.upload') }}" method="post" enctype="multipart/form-data">
    <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
      <div>
        <label for="files"><strong>Choose files</strong></label><br>
        <input id="files" type="file" name="files" multiple>
      </div>
      <div>
        <label for="subdir">Target subfolder (optional)</label><br>
        <input id="subdir" type="text" name="subdir" placeholder="e.g. reports/2024">
      </div>
    </div>
    <div style="margin-top:10px;">
      <input type="submit" value="Upload">
    </div>
  </form>

  {% if upload_result %}
    <div style="margin-top:16px;">
      <h3>Upload result{% if upload_result.subdir %} (to <code>{{ upload_result.subdir }}</code>){% endif %}</h3>

      {% if upload_result.saved and upload_result.saved|length > 0 %}
        <p><strong>Saved {{ upload_result.saved|length }}</strong> file{{ 's' if upload_result.saved|length != 1 else '' }}:</p>
        <ul class="list">
          {% for item in upload_result.saved %}
            <li><code>{{ item.name }}</code> → <code>{{ item.saved_as }}</code></li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if upload_result.skipped and upload_result.skipped|length > 0 %}
        <p><strong>Skipped {{ upload_result.skipped|length }}</strong> file{{ 's' if upload_result.skipped|length != 1 else '' }}:</p>
        <ul class="list">
          {% for item in upload_result.skipped %}
            <li><code>{{ item.name }}</code> — {{ item.reason }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if (not upload_result.saved or upload_result.saved|length == 0) and (not upload_result.skipped or upload_result.skipped|length == 0) %}
        <p>No files were received.</p>
      {% endif %}
    </div>
  {% endif %}
</section>
